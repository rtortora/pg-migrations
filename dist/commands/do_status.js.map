{"version":3,"sources":["../../src/commands/do_status.js"],"names":["Table","require","sortBy","module","exports","host","args","migrationStatusMap","sortedKeys","Array","from","keys","key","get","applied","migrated_at","table","head","status","push","local","filename","console","log","toString","doStatus"],"mappings":";;AAAA,MAAMA,QAAQC,QAAQ,WAAR,CAAd;;AACA,MAAMC,SAASD,QAAQ,eAAR,CAAf;;AAEAE,OAAOC,OAAP;AAAA;AAAA;AAAA,oCAAiB,WAAwBC,IAAxB,EAA8BC,IAA9B,EAAoC;AACnD,UAAMC,2BAA2BF,KAAKE,kBAAL,EAAjC;AACA,UAAMC,aAAaN,OAAOO,MAAMC,IAAN,CAAWH,mBAAmBI,IAAnB,EAAX,CAAP,EAA8C,CAC9DC,GAAD,IAAO;AAAE,aAAOL,mBAAmBM,GAAnB,CAAuBD,GAAvB,EAA4BE,OAA5B,GAAsC,CAAtC,GAA0C,CAAjD;AAAoD,KADE,EAE9DF,GAAD,IAAO;AAAE,aAAOL,mBAAmBM,GAAnB,CAAuBD,GAAvB,EAA4BE,OAA5B,GAAsCP,mBAAmBM,GAAnB,CAAuBD,GAAvB,EAA4BE,OAA5B,CAAoCC,WAA1E,GAAwFH,GAA/F;AAAoG,KAF9C,CAA9C,CAAnB;AAIA,UAAMI,QAAQ,IAAIhB,KAAJ,CAAU;AACtBiB,YAAM,CAAE,KAAF,EAAS,QAAT,EAAmB,MAAnB;AADgB,KAAV,CAAd;;AAGA,SAAI,IAAIL,GAAR,IAAeJ,UAAf,EAA2B;AACzB,YAAMU,SAASX,mBAAmBM,GAAnB,CAAuBD,GAAvB,CAAf;AACAI,YAAMG,IAAN,CAAW,CACTP,GADS,EAETM,OAAOJ,OAAP,GAAkB,SAAQI,OAAOJ,OAAP,CAAeC,WAAY,EAArD,GAA0D,MAFjD,EAGTG,OAAOE,KAAP,GAAeF,OAAOE,KAAP,CAAaC,QAA5B,GAAwC,iBAH/B,CAAX;AAKD;;AACDC,YAAQC,GAAR,CAAYP,MAAMQ,QAAN,EAAZ;AACD,GAlBD;;AAAA,kBAAgCC,QAAhC;AAAA;AAAA;AAAA","file":"do_status.js","sourcesContent":["const Table = require('cli-table');\nconst sortBy = require('lodash.sortby');\n\nmodule.exports = async function doStatus(host, args) {\n  const migrationStatusMap = await host.migrationStatusMap();\n  const sortedKeys = sortBy(Array.from(migrationStatusMap.keys()), [\n    (key)=>{ return migrationStatusMap.get(key).applied ? 0 : 1 },\n    (key)=>{ return migrationStatusMap.get(key).applied ? migrationStatusMap.get(key).applied.migrated_at : key },\n  ]);\n  const table = new Table({\n    head: [ \"Key\", \"Status\", \"Path\" ],\n  });\n  for(let key of sortedKeys) {\n    const status = migrationStatusMap.get(key);\n    table.push([\n      key,\n      status.applied ? `up at ${status.applied.migrated_at}` : `down`,\n      status.local ? status.local.filename : `*** NO FILE ***`,\n    ]);\n  }\n  console.log(table.toString());\n}\n"]}